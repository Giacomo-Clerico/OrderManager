<h1 class="text-2xl font-bold mb-4">Products</h1>

<div class="mb-6">
    <h3 class="text-lg font-semibold mb-2">Import Product JSON</h3>

    <%= form_with url: import_json_products_path, method: :post, local: true, multipart: true, class: "flex items-center space-x-4" do |form| %>
        <%= form.file_field :file, accept: 'application/json', class: "block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none" %>
        <%= form.submit "Import JSON", class: "px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition" %>
    <% end %>
</div>

<div class="mt-4 mb-4">
<%= link_to "New Product", new_product_path, class: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700" %>
</div>

<div class="mb-6">
<%= form_with url: products_path, method: :get, local: true, class: "flex flex-wrap items-center gap-3 mb-4" do %>
    <!-- Search input -->
    <%= text_field_tag :query, params[:query], 
        placeholder: "Search by code or description...",
        class: "flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2" %>

    <!-- Type filter -->
    <%= select_tag :type, 
        options_for_select([["All types", ""]] + @types.map { |t| [t, t] }, params[:type]),
        class: "rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2" %>

    <!-- Category filter -->
    <%= select_tag :category, 
        options_for_select([["All categories", ""]] + @categories.map { |c| [c, c] }, params[:category]),
        class: "rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2" %>

    <!-- Submit button -->
    <%= submit_tag "Search",
        class: "inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2" %>
<% end %>
</div>


<table class="min-w-full border border-gray-300 rounded-lg overflow-hidden shadow-sm">
    <thead>
        <tr class="bg-gray-100">
        <th class="border border-gray-300 px-4 py-2 text-left">Code</th>
        <th class="border border-gray-300 px-4 py-2 text-left">Description</th>
        <th class="border border-gray-300 px-4 py-2 text-left">Category</th>
        <th class="border border-gray-300 px-4 py-2 text-left">Type</th>
        <th class="border border-gray-300 px-4 py-2">Actions</th>
        </tr>
    </thead>
    <tbody>
        <% @products.each do |product| %>
        <tr>
            <td class="border border-gray-300 px-4 py-2"><%= link_to product.code, product_path(product) %></td>
            <td class="border border-gray-300 px-4 py-2">
            <%= sanitize(product.desctription.body.to_html, tags: ActionView::Base.sanitized_allowed_tags - ['figure', 'img', 'action-text-attachment']) if product.desctription.present? %>
            </td>
            <td class="border border-gray-300 px-4 py-2"><%= product.category %></td>
            <td class="border border-gray-300 px-4 py-2"><%= product.product_type %></td>
            <td class="border border-gray-300 px-4 py-2 space-x-2">
            <%= link_to "Edit", edit_product_path(product), class: "text-green-500 hover:underline" %>
            <%= button_to "Delete", product_path(product), method: :delete, data: { confirm: "Are you sure?" }, class: "text-red-500 hover:underline" %>
            </td>
        </tr>
        <% end %>
    </tbody>
</table>

