<h1 class="font-bold text-xl">Quote Details</h1>

<p>
    <strong>Requested by:</strong>
    <%= @quote.requested_by.email.split("@").first %>
</p>

<p>
    <strong>Order:</strong>
    <%= link_to @order.name, @order %>
</p>

<p>
    <strong>Company:</strong>
    <%= @quote.company %>
</p>

<p>
    <strong>Buy As:</strong>
    <%= @quote.prefix_name %>
</p>

<p>
    <strong>Company Address:</strong>
    <%= @quote.company_address %>
</p>

<div>
    <strong>Body:</strong>
    <div class="border-1 border-black rounded-lg p-2 my-2 inline-block">
        <%= @quote.body %>
    </div>
</div>

<div class="mt-4 mb-2 flex gap-2">
    <%= link_to "Modify Quote", edit_order_quote_path(@order, @quote), class: "bg-blue-500 text-white px-3 py-1 rounded" %>
    <% if @order.quotes_submitted_by.blank? %>
        <%= button_to "Remove Quote",
                order_quote_path(@order, @quote),
                method: :delete,
                data: { confirm: "Are you sure you want to delete this quote?" },
                class: "bg-red-500 text-white px-3 py-1 rounded" %>
    <% end %>
</div>

<hr>

<h2>Items:</h2>

<% if @items.any? %>
    <table class="table-auto border-collapse border border-gray-300">
    <thead>
        <tr>
            <th class="border border-gray-300 px-2 py-1">Name</th>
            <th class="border border-gray-300 px-2 py-1">Price</th>
        </tr>
    </thead>
    <tbody>
        <% @items.each do |item| %>
            <tr>
                <td class="border border-gray-300 px-2 py-1"><%= item.item_name %></td>
                <td class="border border-gray-300 px-2 py-1"><%= number_to_currency(item.price, unit: currency_symbol_for(item.currency)) %></td>
            </tr>
        <% end %>
    </tbody>
    </table>
<% else %>
    <p>No items added yet.</p>
<% end %>
<%= form_with(model: Item.new, url: order_quote_items_path(@quote.order, @quote), local: true) do |f| %>
    <div class="flex gap-2 mt-2">
        <%= f.text_field :item_name, placeholder: "Item name", class: "border p-1 rounded" %>
        <%= f.number_field :price, placeholder: "Price", class: "border p-1 rounded", min: 1 %>
        <%= f.select :currency, ["USD", "ZMW", "ZAR", "EUR"],
        { selected: @quote.items.first&.currency }, class: "mt-1 block border border-gray-300 rounded-md p-2" %>
        <%= f.submit "Add", class: "bg-green-500 text-white px-2 rounded" %>
    </div>
<% end %>


<div class="mt-4">
    <%= link_to "Back to Order", @order, class: "bg-gray-500 text-white px-3 py-1 rounded" %>
</div>